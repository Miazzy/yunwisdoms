(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06bfe04a"],{b098:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a-tree-select",{staticStyle:{width:"100%"},attrs:{allowClear:"",labelInValue:"",disabled:e.disabled,dropdownStyle:{maxHeight:"400px",overflow:"auto"},placeholder:e.placeholder,loadData:e.asyncLoadTreeData,value:e.treeValue,treeData:e.treeData,multiple:e.multiple},on:{change:e.onChange,search:e.onSearch}})},l=[],n=i("7618"),r=(i("ac4d"),i("8a81"),i("ac6a"),i("75fc")),o=(i("28a5"),i("0fea")),s={name:"JTreeSelect",props:{value:{type:String,required:!1},placeholder:{type:String,default:"请选择",required:!1},dict:{type:String,default:"",required:!1},pidField:{type:String,default:"pid",required:!1},pidValue:{type:String,default:"",required:!1},disabled:{type:Boolean,default:!1,required:!1},hasChildField:{type:String,default:"",required:!1},condition:{type:String,default:"",required:!1},multiple:{type:Boolean,default:!1},loadTriggleChange:{type:Boolean,default:!1,required:!1}},data:function(){return{treeValue:null,treeData:[],url:"/sys/dict/loadTreeData",view:"/sys/dict/loadDictItem/",tableName:"",text:"",code:""}},watch:{value:function(){this.loadItemByCode()},dict:function(){this.initDictInfo(),this.loadRoot()}},created:function(){var e=this;this.validateProp().then((function(){e.initDictInfo(),e.loadRoot(),e.loadItemByCode()}))},methods:{loadItemByCode:function(){var e=this;this.value&&"0"!=this.value?Object(o["getAction"])("".concat(this.view).concat(this.dict),{key:this.value}).then((function(t){if(t.success){var i=e.value.split(",");e.treeValue=t.result.map((function(e,t){return{key:i[t],value:i[t],label:e}})),e.onLoadTriggleChange(t.result[0])}})):this.treeValue=null},onLoadTriggleChange:function(e){!this.multiple&&this.loadTriggleChange&&this.$emit("change",this.value,e)},initDictInfo:function(){var e=this.dict.split(",");this.tableName=e[0],this.text=e[1],this.code=e[2]},asyncLoadTreeData:function(e){var t=this;return new Promise((function(i){if(e.$vnode.children)i();else{var a=e.$vnode.key,l={pid:a,tableName:t.tableName,text:t.text,code:t.code,pidField:t.pidField,hasChildField:t.hasChildField,condition:t.condition};Object(o["getAction"])(t.url,l).then((function(e){if(e.success){var l=!0,n=!1,o=void 0;try{for(var s,d=e.result[Symbol.iterator]();!(l=(s=d.next()).done);l=!0){var c=s.value;c.value=c.key,0==c.leaf?c.isLeaf=!1:1==c.leaf&&(c.isLeaf=!0)}}catch(u){n=!0,o=u}finally{try{l||null==d.return||d.return()}finally{if(n)throw o}}t.addChildren(a,e.result,t.treeData),t.treeData=Object(r["a"])(t.treeData)}i()}))}}))},addChildren:function(e,t,i){if(i&&i.length>0){var a=!0,l=!1,n=void 0;try{for(var r,o=i[Symbol.iterator]();!(a=(r=o.next()).done);a=!0){var s=r.value;if(s.key==e){t&&0!=t.length?s.children=t:s.isLeaf=!0;break}this.addChildren(e,t,s.children)}}catch(d){l=!0,n=d}finally{try{a||null==o.return||o.return()}finally{if(l)throw n}}}},loadRoot:function(){var e=this,t={pid:this.pidValue,tableName:this.tableName,text:this.text,code:this.code,pidField:this.pidField,hasChildField:this.hasChildField,condition:this.condition};Object(o["getAction"])(this.url,t).then((function(t){if(t.success&&t.result){var i=!0,a=!1,l=void 0;try{for(var n,o=t.result[Symbol.iterator]();!(i=(n=o.next()).done);i=!0){var s=n.value;s.value=s.key,0==s.leaf?s.isLeaf=!1:1==s.leaf&&(s.isLeaf=!0)}}catch(d){a=!0,l=d}finally{try{i||null==o.return||o.return()}finally{if(a)throw l}}e.treeData=Object(r["a"])(t.result)}else console.log("数根节点查询结果-else",t)}))},onChange:function(e){e?e instanceof Array?(this.$emit("change",e.map((function(e){return e.value})).join(",")),this.treeValue=e):(this.$emit("change",e.value,e.label),this.treeValue=e):(this.$emit("change",""),this.treeValue=null)},onSearch:function(e){console.log(e)},getCurrTreeData:function(){return this.treeData},validateProp:function(){var e=this,t=this.condition;return new Promise((function(i,a){if(t)try{var l=JSON.parse(t);console.log("aaaaasdsdd",Object(n["a"])(l)),"object"==Object(n["a"])(l)&&l?i():(e.$message.error("组件JTreeSelect-condition传值有误，需要一个json字符串!"),a())}catch(r){e.$message.error("组件JTreeSelect-condition传值有误，需要一个json字符串!"),a()}else i()}))}},model:{prop:"value",event:"change"}},d=s,c=i("2877"),u=Object(c["a"])(d,a,l,!1,null,null,null);t["default"]=u.exports},f1cf:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a-modal",{attrs:{title:e.title,width:e.width,visible:e.visible,confirmLoading:e.confirmLoading,destroyOnClose:!0,cancelText:"关闭"},on:{ok:e.handleOk,cancel:e.handleCancel}},[i("a-spin",{attrs:{spinning:e.confirmLoading}},[i("a-form",{attrs:{form:e.form}},[i("a-form-item",{attrs:{label:"父级节点",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[i("j-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["pid",e.validatorRules.pid],expression:"['pid', validatorRules.pid]"}],ref:"treeSelect",attrs:{placeholder:"请选择父级节点",dict:"sys_category,name,id",pidField:"pid",pidValue:"0"}})],1),i("a-form-item",{attrs:{label:"类型名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[i("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",e.validatorRules.name],expression:"[ 'name', validatorRules.name]"}],attrs:{placeholder:"请输入类型名称"}})],1)],1)],1)],1)},l=[],n=i("0fea"),r=i("b098"),o={name:"SysCategoryModal",components:{JTreeSelect:r["default"]},data:function(){return{form:this.$form.createForm(this),title:"操作",width:800,visible:!1,model:{},labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},confirmLoading:!1,validatorRules:{code:{rules:[{required:!0,message:"请输入类型编码!"},{validator:this.validateMyCode}]},pid:{},name:{}},url:{add:"/sys/category/add",edit:"/sys/category/edit",checkCode:"/sys/category/checkCode"},expandedRowKeys:[],pidField:"pid"}},created:function(){},methods:{add:function(){this.edit({})},edit:function(e){var t=this;this.form.resetFields(),this.model=Object.assign({},e),this.visible=!0,this.$nextTick((function(){t.form.setFieldsValue(pick(t.model,"pid","name","code"))}))},close:function(){this.$emit("close"),this.visible=!1},handleOk:function(){var e=this,t=this;this.form.validateFields((function(i,a){if(!i){t.confirmLoading=!0;var l="",r="";e.model.id?(l+=e.url.edit,r="put"):(l+=e.url.add,r="post");var o=Object.assign(e.model,a);console.log("表单提交数据",o),Object(n["httpAction"])(l,o,r).then((function(e){e.success?(t.$message.success(e.message),t.submitSuccess(o)):t.$message.warning(e.message)})).finally((function(){t.confirmLoading=!1,t.close()}))}}))},handleCancel:function(){this.close()},popupCallback:function(e){this.form.setFieldsValue(pick(e,"pid","name","code"))},submitSuccess:function(e){if(e.id)this.$emit("ok",e);else{var t=this.$refs.treeSelect.getCurrTreeData();this.expandedRowKeys=[],this.getExpandKeysByPid(e[this.pidField],t,t),this.$emit("ok",e,this.expandedRowKeys.reverse())}},getExpandKeysByPid:function(e,t,i){if(e&&t&&t.length>0)for(var a=0;a<t.length;a++)t[a].key==e?(this.expandedRowKeys.push(t[a].key),this.getExpandKeysByPid(t[a]["parentId"],i,i)):this.getExpandKeysByPid(e,t[a].children,i)},validateMyCode:function(e,t,i){var a={pid:this.form.getFieldValue("pid"),code:t};Object(n["getAction"])(this.url.checkCode,a).then((function(e){e.success?i():i(e.message)}))}}},s=o,d=i("2877"),c=Object(d["a"])(s,a,l,!1,null,null,null);t["default"]=c.exports}}]);